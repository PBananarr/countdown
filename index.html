<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>🎉 Geburtstags-Quest</title>

  <!-- Globales, responsives Grundlayout -->
  <link rel="stylesheet" href="core/core.css"/>

  <!-- Tages-Stylesheet wird dynamisch gesetzt -->
  <link id="day-style" rel="stylesheet" href="">

  <meta name="theme-color" content="#0b1223">
</head>
<body class="app">
  <header class="topbar">
    <h1>🎂 Geburtstags-Quest</h1>
    <p class="subtitle">Tägliche Rätsel bis zum großen Tag</p>

    <div class="countdown" aria-live="polite">
      <strong id="countdown">–</strong>
    </div>

    <div class="progresswrap" aria-hidden="true">
      <div class="progress" id="progress"></div>
    </div>
    <p class="progresslabel">
      <span id="doneCount">0</span>/<span id="totalCount">0</span> Rätsel gelöst
      <span id="devBadge" class="devbadge" hidden>DEV</span>
    </p>

    <nav class="daynav" id="dayNav" aria-label="Tage"></nav>

    <div class="daycontrols">
      <button class="btn ghostbtn" id="prevDay" aria-label="Voriger Tag">◀</button>
      <div id="dayLabel" class="daylabel">–</div>
      <button class="btn ghostbtn" id="nextDay" aria-label="Nächster Tag">▶</button>
    </div>
  </header>

  <main id="dayHost" class="dayhost" role="main"></main>

  <section class="final" id="final" aria-live="polite" hidden>
    <h2>🎉 Geschafft!</h2>
    <p class="bigmsg">Herzlichen Glückwunsch zum <strong>37.</strong> Geburtstag! 🥳</p>
    <p>Für eine tapfere Soldatin, liebevolle Mama und Abenteurerin – möge dein Jahr so stark, wild und hell sein wie du. 💚</p>
    <p>Ich freue mich noch auf so viele wunderbare Momente in unserem Leben und bin jeden Tag aufs neue Dankbar für dich, das wir uns gefunden haben und 
      und das wir diese außergewöhnliche perfekte Freundschaft führen.
    </p>
    <p>Ich bin stolz auf dich und ich werde dich immer Lieben. 💖</p>
    <div class="badgewrap" id="badges"></div>
    <div class="finalbtns">
      <button class="btn primary" id="shareBtn">Teilen</button>
      <button class="btn ghostbtn" id="replayBtn">Noch mal spielen</button>
    </div>
  </section>

  <div id="confetti" aria-hidden="true"></div>

  <footer class="foot">
    <small>
      Made with 💛 von Miki ·
      <button class="link" id="resetBtn">Zurücksetzen</button>
      <span class="sep">·</span>
      <button class="link" id="aboutBtn">Hinweise</button>
    </small>
    <span id="sw-version"></span>
  </footer>

  <dialog id="about">
    <h3>Hinweise</h3>
    <ul>
      <li>Täglich wird ein neuer Tag freigeschaltet (17.09.25 – 23.09.25).</li>
      <li>Dein Fortschritt bleibt lokal gespeichert.</li>
      <li>Absolviere alle Challenges und sichere dir am Tag 7 deine Überraschung 😊</li>
      <li>Viel Erfolg 🍀💖</li>
    </ul>
    <form method="dialog">
      <button class="btn">Okay</button>
    </form>
  </dialog>

  <!-- Kernlogik (ES-Module) -->
  <script type="module" src="core/main.js"></script>

  <script>
  if ("serviceWorker" in navigator) {
    // Basis-URL ermitteln (funktioniert auch in Unterordnern/Pages)
    const base = location.pathname.replace(/\/index\.html$/, "/");
    const swUrl = base + "sw.js";

    navigator.serviceWorker.register(swUrl).then((reg) => {
      // Countdown auf neue Version: wenn neuer SW installiert ist und ein Controller existiert
      reg.addEventListener("updatefound", () => {
        const nw = reg.installing;
        nw?.addEventListener("statechange", () => {
          if (nw.state === "installed" && navigator.serviceWorker.controller) {
            // sanfter Reload: du kannst hier auch ein „Update verfügbar“-Banner zeigen
            // navigator.serviceWorker.controller.postMessage("SKIP_WAITING");
            // location.reload(); // <- automatischer Reload (optional)
            console.log("Neue Version installiert. Reload für Update.");
          }
        });
      });
    }).catch((err) => console.warn("SW-Registrierung fehlgeschlagen:", err));

    // Wenn der aktive Controller wechselt (nach skipWaiting), Seite aktualisieren
    navigator.serviceWorker.addEventListener("controllerchange", () => {
      // location.reload(); // optional: automatischer Reload
    });
  }
</script>

</body>
</html>
